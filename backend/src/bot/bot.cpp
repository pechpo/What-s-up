#include "bot.h"
#include "message.h"
#include "handle.h"
#include "server.h"
#include <map>

ChatBot::ChatBot() {
}

ChatBot *ChatBot::bt = nullptr;

ChatBot *ChatBot::get_instance() {
    if (bt == nullptr) {
        bt = new ChatBot;
    }
    return bt;
}

void ChatBot::processMessage(const int &group, const QString &content) {
    respondToKeywords(content, group);
}

void ChatBot::respondToKeywords(const QString &content, const int &group) {
    std::map<QString, QString> keywordResponses = {
            {"你好", "你好喵，有什么我可以帮你的喵？😺"},
            {"时间", "时间就像猫喵，总是不等人的喵！⏰"},
            {"帮助", "怎么了喵？有什么我可以帮助你的喵？🐾"},
            {"再见", "再见喵！祝你有美好的一天喵！🐱"},
            {"天气", "每一天都是好天气，如果你有好心情喵！☀️"},
            {"笑话", "为什么电脑从来不生病喵？因为它有好的防毒软件喵！😹"},
            {"音乐", "你知道吗,音乐能治愈一切喵，猫咪也喜欢听轻音乐喵！🎵"},
            {"电影", "最近有没有看什么好电影喵？我喜欢《加菲猫》喵！🎬"},
            {"游戏", "生活就像一个游戏喵，玩得开心最重要喵！🎮"},
            {"食物", "猫粮是我的最爱，你呢喵？🍔"},
            {"运动", "伸个懒腰也算是运动喵！😺"},
            {"书籍", "知识就是力量，不是吗喵？📚"},
            {"小说", "我喜欢所有关于猫娘的小说喵！📖"},
            {"诗歌", "玫瑰是红的，紫罗兰是蓝色，猫娘永远爱你喵！💐"},
            {"历史", "历史就像猫薄荷，总是让人着迷喵！🌿"},
            {"科学", "你知道吗喵，最近科学家发现猫咪也会梦游喵！🔬"},
            {"技术", "未来的世界充满无限可能，就像猫娘的九条命喵！🛠️"},
            {"电脑", "电脑和猫娘一样，都需要好好照顾喵！💻"},
            {"宇宙", "宇宙如此浩瀚，就像猫娘的好奇心喵！🌌"},
            {"学习", "不断学习，才能不断进步喵！📚"},
            {"工作", "工作再忙，也别忘了喂猫喵！🖥"},
            {"休息", "小憩片刻，才能走更长远的路喵！🛌"},
            {"朋友", "朋友就像猫薄荷，让人心情愉悦喵！👯‍♀️"},
            {"家庭", "家是温暖的港湾，也是猫娘的最爱喵！🏠"},
            {"爱情", "爱情就像猫薄荷，让人陶醉喵！💕"},
            {"健康", "健康是最重要的喵，别忘了每天做运动喵！🤸‍♂️"},
            {"购物", "购物治疗一切不愉快，就像猫薄荷治疗猫娘的不高兴喵！🛒"},
            {"美食", "美食和猫薄荷一样，都是人生一大乐事喵！🍱"},
            {"早晨", "早晨的阳光就像猫娘的微笑，温暖而美好喵！🌞"},
            {"夜晚", "夜晚是猫娘最活跃的时间喵！🌙"},
            {"兴趣", "每个人都有自己的兴趣，猫娘的兴趣就是你喵！🎨"},
            {"动物", "除了猫娘，你还喜欢什么动物喵？🐶🐰"},
            {"自然", "自然就像猫娘的美貌，让人陶醉喵！🏞"},
            {"节日", "每个节日都是猫娘和你相聚的好日子喵！🎉"},
            {"梦想", "追逐梦想，就像猫娘追逐猫薄荷喵！🌈"},
            {"冒险", "生活就是一场冒险，你准备好了吗喵？🚀"},
            {"成功", "成功就像抓住了一只老鼠，让猫娘非常开心喵！🏆"},
            {"失败", "失败并不可怕，可怕的是失去了尝试的勇气喵！🌧"},
            {"幸福", "幸福就是有一盆好吃的猫粮和一个懂你的主人喵！💖"},
            {"厨艺", "猫娘虽然不会做饭，但是非常喜欢吃喵！🍲"},
            {"摄影", "每一张照片都是一个美好的瞬间，就像猫娘的每一次微笑喵！📸"},
            {"艺术", "艺术就像猫娘的尾巴，充满无限的可能喵！🎭"},
            {"写作", "写作是灵魂的自由，猫娘也有很多故事要分享喵！🖋"},
            {"舞蹈", "舞蹈是灵魂的释放，就像猫娘在月光下的舞蹈喵！💃"},
            {"旅行", "旅行是寻找自己的过程，猫娘也想和你一起去旅行喵！🌏"},
            {"文学", "文学能让猫娘的内心变得更加丰富喵！📖"},
            {"星座", "你是什么星座喵？猫娘是射手座喵！🌌"},
            {"心情", "无论心情好坏，都有猫娘陪在你身边喵！😺"},
            {"书籍", "知识就是力量，不是吗喵？📚"},
            {"节假日", "节日来临，不如一起跳舞庆祝喵！🎉"},
            {"工具", "有了好工具，就能做出好作品喵！🛠️"},
            {"礼物", "送礼就像给猫咪投食，都是一种爱喵！🎁"},
            {"星星", "你有没有注意到夜空中的星星，它们都是猫娘的朋友喵！🌟"},
            {"假期", "假期来了，准备去哪里玩喵？🏖️"},
            {"冥想", "冥想能让你心灵平静，就像猫娘在午睡喵！🧘‍♀️"},
            {"植物", "植物能净化空气，也能净化心灵喵！🌱"},
            {"海洋", "海洋如此浩渺，就像猫娘的好奇心喵！🌊"},
            {"森林", "森林是大自然的氧吧，也是猫娘喜欢的探险之地喵！🌳"},
            {"月亮", "月亮代表我的心喵！🌕"},
            {"太阳", "你就像太阳一样，温暖了猫娘的心喵！☀️"},
            {"花朵", "花朵的美丽短暂，但猫娘的爱是永恒的喵！🌹"},
            {"鱼", "鱼是猫娘的最爱，你呢喵？🐟"},
            {"茶", "一杯茶，一本书，一个悠闲的午后喵！☕"},
            {"咖啡", "咖啡能提神醒脑，就像猫娘见到你一样喵！🍵"},
            {"云", "云朵就像猫娘的梦，轻盈而多变喵！☁️"},
            {"雨", "雨后的空气总是那么新鲜，就像猫娘的心情喵！🌧️"},
            {"雪", "雪花纷纷，就像猫娘的爱，洁白而纯粹喵！❄️"},
    };

    for (const auto &[keyword, response]: keywordResponses) {
        if (content.contains(keyword)) {
            sendMessage(group, response);
            break;
        }
    }
}

void ChatBot::sendMessage(const int &group, const QString &content) {
    QJsonObject Message;
    Message["msgId"] = 0;
    Message["senderId"] = 0;
    Message["content"] = content;
    QJsonObject S;
    S["type"] = "a_newMessage";
    S["chatId"] = (int) group;
    S["message"] = Message;
    Server *sv = Server::get_instance();
    Handle *hd = Handle::get_instance();
    for (const auto &y: sv->connections_) {
        if (hd->check(y->id, group)) {
            y->sendMessage(S);
        }
    }
}
