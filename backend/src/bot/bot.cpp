#include "bot.h"
#include "message.h"
#include "handle.h"
#include "server.h"
#include <map>

ChatBot::ChatBot() {
}

ChatBot *ChatBot::bt = nullptr;

ChatBot *ChatBot::get_instance() {
    if (bt == nullptr) {
        bt = new ChatBot;
    }
    return bt;
}

void ChatBot::processMessage(const int &group, const QString &content) {
    respondToKeywords(content, group);
}

void ChatBot::respondToKeywords(const QString &content, const int &group) {
    std::map<QString, QString> keywordResponses = {
            {"ä½ å¥½", "ä½ å¥½å–µï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å–µï¼ŸðŸ˜º"},
            {"æ—¶é—´", "æ—¶é—´å°±åƒçŒ«å–µï¼Œæ€»æ˜¯ä¸ç­‰äººçš„å–µï¼â°"},
            {"å¸®åŠ©", "æ€Žä¹ˆäº†å–µï¼Ÿæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å–µï¼ŸðŸ¾"},
            {"å†è§", "å†è§å–µï¼ç¥ä½ æœ‰ç¾Žå¥½çš„ä¸€å¤©å–µï¼ðŸ±"},
            {"å¤©æ°”", "æ¯ä¸€å¤©éƒ½æ˜¯å¥½å¤©æ°”ï¼Œå¦‚æžœä½ æœ‰å¥½å¿ƒæƒ…å–µï¼â˜€ï¸"},
            {"ç¬‘è¯", "ä¸ºä»€ä¹ˆç”µè„‘ä»Žæ¥ä¸ç”Ÿç—…å–µï¼Ÿå› ä¸ºå®ƒæœ‰å¥½çš„é˜²æ¯’è½¯ä»¶å–µï¼ðŸ˜¹"},
            {"éŸ³ä¹", "ä½ çŸ¥é“å—,éŸ³ä¹èƒ½æ²»æ„ˆä¸€åˆ‡å–µï¼ŒçŒ«å’ªä¹Ÿå–œæ¬¢å¬è½»éŸ³ä¹å–µï¼ðŸŽµ"},
            {"ç”µå½±", "æœ€è¿‘æœ‰æ²¡æœ‰çœ‹ä»€ä¹ˆå¥½ç”µå½±å–µï¼Ÿæˆ‘å–œæ¬¢ã€ŠåŠ è²çŒ«ã€‹å–µï¼ðŸŽ¬"},
            {"æ¸¸æˆ", "ç”Ÿæ´»å°±åƒä¸€ä¸ªæ¸¸æˆå–µï¼ŒçŽ©å¾—å¼€å¿ƒæœ€é‡è¦å–µï¼ðŸŽ®"},
            {"é£Ÿç‰©", "çŒ«ç²®æ˜¯æˆ‘çš„æœ€çˆ±ï¼Œä½ å‘¢å–µï¼ŸðŸ”"},
            {"è¿åŠ¨", "ä¼¸ä¸ªæ‡’è…°ä¹Ÿç®—æ˜¯è¿åŠ¨å–µï¼ðŸ˜º"},
            {"ä¹¦ç±", "çŸ¥è¯†å°±æ˜¯åŠ›é‡ï¼Œä¸æ˜¯å—å–µï¼ŸðŸ“š"},
            {"å°è¯´", "æˆ‘å–œæ¬¢æ‰€æœ‰å…³äºŽçŒ«å¨˜çš„å°è¯´å–µï¼ðŸ“–"},
            {"è¯—æ­Œ", "çŽ«ç‘°æ˜¯çº¢çš„ï¼Œç´«ç½—å…°æ˜¯è“è‰²ï¼ŒçŒ«å¨˜æ°¸è¿œçˆ±ä½ å–µï¼ðŸ’"},
            {"åŽ†å²", "åŽ†å²å°±åƒçŒ«è–„è·ï¼Œæ€»æ˜¯è®©äººç€è¿·å–µï¼ðŸŒ¿"},
            {"ç§‘å­¦", "ä½ çŸ¥é“å—å–µï¼Œæœ€è¿‘ç§‘å­¦å®¶å‘çŽ°çŒ«å’ªä¹Ÿä¼šæ¢¦æ¸¸å–µï¼ðŸ”¬"},
            {"æŠ€æœ¯", "æœªæ¥çš„ä¸–ç•Œå……æ»¡æ— é™å¯èƒ½ï¼Œå°±åƒçŒ«å¨˜çš„ä¹æ¡å‘½å–µï¼ðŸ› ï¸"},
            {"ç”µè„‘", "ç”µè„‘å’ŒçŒ«å¨˜ä¸€æ ·ï¼Œéƒ½éœ€è¦å¥½å¥½ç…§é¡¾å–µï¼ðŸ’»"},
            {"å®‡å®™", "å®‡å®™å¦‚æ­¤æµ©ç€šï¼Œå°±åƒçŒ«å¨˜çš„å¥½å¥‡å¿ƒå–µï¼ðŸŒŒ"},
            {"å­¦ä¹ ", "ä¸æ–­å­¦ä¹ ï¼Œæ‰èƒ½ä¸æ–­è¿›æ­¥å–µï¼ðŸ“š"},
            {"å·¥ä½œ", "å·¥ä½œå†å¿™ï¼Œä¹Ÿåˆ«å¿˜äº†å–‚çŒ«å–µï¼ðŸ–¥"},
            {"ä¼‘æ¯", "å°æ†©ç‰‡åˆ»ï¼Œæ‰èƒ½èµ°æ›´é•¿è¿œçš„è·¯å–µï¼ðŸ›Œ"},
            {"æœ‹å‹", "æœ‹å‹å°±åƒçŒ«è–„è·ï¼Œè®©äººå¿ƒæƒ…æ„‰æ‚¦å–µï¼ðŸ‘¯â€â™€ï¸"},
            {"å®¶åº­", "å®¶æ˜¯æ¸©æš–çš„æ¸¯æ¹¾ï¼Œä¹Ÿæ˜¯çŒ«å¨˜çš„æœ€çˆ±å–µï¼ðŸ "},
            {"çˆ±æƒ…", "çˆ±æƒ…å°±åƒçŒ«è–„è·ï¼Œè®©äººé™¶é†‰å–µï¼ðŸ’•"},
            {"å¥åº·", "å¥åº·æ˜¯æœ€é‡è¦çš„å–µï¼Œåˆ«å¿˜äº†æ¯å¤©åšè¿åŠ¨å–µï¼ðŸ¤¸â€â™‚ï¸"},
            {"è´­ç‰©", "è´­ç‰©æ²»ç–—ä¸€åˆ‡ä¸æ„‰å¿«ï¼Œå°±åƒçŒ«è–„è·æ²»ç–—çŒ«å¨˜çš„ä¸é«˜å…´å–µï¼ðŸ›’"},
            {"ç¾Žé£Ÿ", "ç¾Žé£Ÿå’ŒçŒ«è–„è·ä¸€æ ·ï¼Œéƒ½æ˜¯äººç”Ÿä¸€å¤§ä¹äº‹å–µï¼ðŸ±"},
            {"æ—©æ™¨", "æ—©æ™¨çš„é˜³å…‰å°±åƒçŒ«å¨˜çš„å¾®ç¬‘ï¼Œæ¸©æš–è€Œç¾Žå¥½å–µï¼ðŸŒž"},
            {"å¤œæ™š", "å¤œæ™šæ˜¯çŒ«å¨˜æœ€æ´»è·ƒçš„æ—¶é—´å–µï¼ðŸŒ™"},
            {"å…´è¶£", "æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„å…´è¶£ï¼ŒçŒ«å¨˜çš„å…´è¶£å°±æ˜¯ä½ å–µï¼ðŸŽ¨"},
            {"åŠ¨ç‰©", "é™¤äº†çŒ«å¨˜ï¼Œä½ è¿˜å–œæ¬¢ä»€ä¹ˆåŠ¨ç‰©å–µï¼ŸðŸ¶ðŸ°"},
            {"è‡ªç„¶", "è‡ªç„¶å°±åƒçŒ«å¨˜çš„ç¾Žè²Œï¼Œè®©äººé™¶é†‰å–µï¼ðŸž"},
            {"èŠ‚æ—¥", "æ¯ä¸ªèŠ‚æ—¥éƒ½æ˜¯çŒ«å¨˜å’Œä½ ç›¸èšçš„å¥½æ—¥å­å–µï¼ðŸŽ‰"},
            {"æ¢¦æƒ³", "è¿½é€æ¢¦æƒ³ï¼Œå°±åƒçŒ«å¨˜è¿½é€çŒ«è–„è·å–µï¼ðŸŒˆ"},
            {"å†’é™©", "ç”Ÿæ´»å°±æ˜¯ä¸€åœºå†’é™©ï¼Œä½ å‡†å¤‡å¥½äº†å—å–µï¼ŸðŸš€"},
            {"æˆåŠŸ", "æˆåŠŸå°±åƒæŠ“ä½äº†ä¸€åªè€é¼ ï¼Œè®©çŒ«å¨˜éžå¸¸å¼€å¿ƒå–µï¼ðŸ†"},
            {"å¤±è´¥", "å¤±è´¥å¹¶ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯å¤±åŽ»äº†å°è¯•çš„å‹‡æ°”å–µï¼ðŸŒ§"},
            {"å¹¸ç¦", "å¹¸ç¦å°±æ˜¯æœ‰ä¸€ç›†å¥½åƒçš„çŒ«ç²®å’Œä¸€ä¸ªæ‡‚ä½ çš„ä¸»äººå–µï¼ðŸ’–"},
            {"åŽ¨è‰º", "çŒ«å¨˜è™½ç„¶ä¸ä¼šåšé¥­ï¼Œä½†æ˜¯éžå¸¸å–œæ¬¢åƒå–µï¼ðŸ²"},
            {"æ‘„å½±", "æ¯ä¸€å¼ ç…§ç‰‡éƒ½æ˜¯ä¸€ä¸ªç¾Žå¥½çš„çž¬é—´ï¼Œå°±åƒçŒ«å¨˜çš„æ¯ä¸€æ¬¡å¾®ç¬‘å–µï¼ðŸ“¸"},
            {"è‰ºæœ¯", "è‰ºæœ¯å°±åƒçŒ«å¨˜çš„å°¾å·´ï¼Œå……æ»¡æ— é™çš„å¯èƒ½å–µï¼ðŸŽ­"},
            {"å†™ä½œ", "å†™ä½œæ˜¯çµé­‚çš„è‡ªç”±ï¼ŒçŒ«å¨˜ä¹Ÿæœ‰å¾ˆå¤šæ•…äº‹è¦åˆ†äº«å–µï¼ðŸ–‹"},
            {"èˆžè¹ˆ", "èˆžè¹ˆæ˜¯çµé­‚çš„é‡Šæ”¾ï¼Œå°±åƒçŒ«å¨˜åœ¨æœˆå…‰ä¸‹çš„èˆžè¹ˆå–µï¼ðŸ’ƒ"},
            {"æ—…è¡Œ", "æ—…è¡Œæ˜¯å¯»æ‰¾è‡ªå·±çš„è¿‡ç¨‹ï¼ŒçŒ«å¨˜ä¹Ÿæƒ³å’Œä½ ä¸€èµ·åŽ»æ—…è¡Œå–µï¼ðŸŒ"},
            {"æ–‡å­¦", "æ–‡å­¦èƒ½è®©çŒ«å¨˜çš„å†…å¿ƒå˜å¾—æ›´åŠ ä¸°å¯Œå–µï¼ðŸ“–"},
            {"æ˜Ÿåº§", "ä½ æ˜¯ä»€ä¹ˆæ˜Ÿåº§å–µï¼ŸçŒ«å¨˜æ˜¯å°„æ‰‹åº§å–µï¼ðŸŒŒ"},
            {"å¿ƒæƒ…", "æ— è®ºå¿ƒæƒ…å¥½åï¼Œéƒ½æœ‰çŒ«å¨˜é™ªåœ¨ä½ èº«è¾¹å–µï¼ðŸ˜º"},
            {"ä¹¦ç±", "çŸ¥è¯†å°±æ˜¯åŠ›é‡ï¼Œä¸æ˜¯å—å–µï¼ŸðŸ“š"},
            {"èŠ‚å‡æ—¥", "èŠ‚æ—¥æ¥ä¸´ï¼Œä¸å¦‚ä¸€èµ·è·³èˆžåº†ç¥å–µï¼ðŸŽ‰"},
            {"å·¥å…·", "æœ‰äº†å¥½å·¥å…·ï¼Œå°±èƒ½åšå‡ºå¥½ä½œå“å–µï¼ðŸ› ï¸"},
            {"ç¤¼ç‰©", "é€ç¤¼å°±åƒç»™çŒ«å’ªæŠ•é£Ÿï¼Œéƒ½æ˜¯ä¸€ç§çˆ±å–µï¼ðŸŽ"},
            {"æ˜Ÿæ˜Ÿ", "ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°å¤œç©ºä¸­çš„æ˜Ÿæ˜Ÿï¼Œå®ƒä»¬éƒ½æ˜¯çŒ«å¨˜çš„æœ‹å‹å–µï¼ðŸŒŸ"},
            {"å‡æœŸ", "å‡æœŸæ¥äº†ï¼Œå‡†å¤‡åŽ»å“ªé‡ŒçŽ©å–µï¼ŸðŸ–ï¸"},
            {"å†¥æƒ³", "å†¥æƒ³èƒ½è®©ä½ å¿ƒçµå¹³é™ï¼Œå°±åƒçŒ«å¨˜åœ¨åˆç¡å–µï¼ðŸ§˜â€â™€ï¸"},
            {"æ¤ç‰©", "æ¤ç‰©èƒ½å‡€åŒ–ç©ºæ°”ï¼Œä¹Ÿèƒ½å‡€åŒ–å¿ƒçµå–µï¼ðŸŒ±"},
            {"æµ·æ´‹", "æµ·æ´‹å¦‚æ­¤æµ©æ¸ºï¼Œå°±åƒçŒ«å¨˜çš„å¥½å¥‡å¿ƒå–µï¼ðŸŒŠ"},
            {"æ£®æž—", "æ£®æž—æ˜¯å¤§è‡ªç„¶çš„æ°§å§ï¼Œä¹Ÿæ˜¯çŒ«å¨˜å–œæ¬¢çš„æŽ¢é™©ä¹‹åœ°å–µï¼ðŸŒ³"},
            {"æœˆäº®", "æœˆäº®ä»£è¡¨æˆ‘çš„å¿ƒå–µï¼ðŸŒ•"},
            {"å¤ªé˜³", "ä½ å°±åƒå¤ªé˜³ä¸€æ ·ï¼Œæ¸©æš–äº†çŒ«å¨˜çš„å¿ƒå–µï¼â˜€ï¸"},
            {"èŠ±æœµ", "èŠ±æœµçš„ç¾Žä¸½çŸ­æš‚ï¼Œä½†çŒ«å¨˜çš„çˆ±æ˜¯æ°¸æ’çš„å–µï¼ðŸŒ¹"},
            {"é±¼", "é±¼æ˜¯çŒ«å¨˜çš„æœ€çˆ±ï¼Œä½ å‘¢å–µï¼ŸðŸŸ"},
            {"èŒ¶", "ä¸€æ¯èŒ¶ï¼Œä¸€æœ¬ä¹¦ï¼Œä¸€ä¸ªæ‚ é—²çš„åˆåŽå–µï¼â˜•"},
            {"å’–å•¡", "å’–å•¡èƒ½æç¥žé†’è„‘ï¼Œå°±åƒçŒ«å¨˜è§åˆ°ä½ ä¸€æ ·å–µï¼ðŸµ"},
            {"äº‘", "äº‘æœµå°±åƒçŒ«å¨˜çš„æ¢¦ï¼Œè½»ç›ˆè€Œå¤šå˜å–µï¼â˜ï¸"},
            {"é›¨", "é›¨åŽçš„ç©ºæ°”æ€»æ˜¯é‚£ä¹ˆæ–°é²œï¼Œå°±åƒçŒ«å¨˜çš„å¿ƒæƒ…å–µï¼ðŸŒ§ï¸"},
            {"é›ª", "é›ªèŠ±çº·çº·ï¼Œå°±åƒçŒ«å¨˜çš„çˆ±ï¼Œæ´ç™½è€Œçº¯ç²¹å–µï¼â„ï¸"},
    };

    for (const auto &[keyword, response]: keywordResponses) {
        if (content.contains(keyword)) {
            sendMessage(group, response);
            break;
        }
    }
}

void ChatBot::sendMessage(const int &group, const QString &content) {
    QJsonObject Message;
    Message["msgId"] = 0;
    Message["senderId"] = 0;
    Message["content"] = content;
    QJsonObject S;
    S["type"] = "a_newMessage";
    S["chatId"] = (int) group;
    S["message"] = Message;
    Server *sv = Server::get_instance();
    Handle *hd = Handle::get_instance();
    for (const auto &y: sv->connections_) {
        if (hd->check(y->id, group)) {
            y->sendMessage(S);
        }
    }
}
